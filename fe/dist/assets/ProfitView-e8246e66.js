import{u as Z}from"./index.es-21745a3a.js";import{d as K,u as L,r as j,k as ee,H as P,p as A,w as l,h as H,m as U,i as d,o as h,b as n,e as f,t as v,f as b,c as T,y as B,F as N,j as w,a as te,I as i,D as F,K as oe,q as re,E as ae,S as E,N as ne}from"./index-a9039ce2.js";const le=K({__name:"UpsertProfitReportModal",props:{upsertProfitReport:Object,currentYear:Number},emits:["closeModal"],setup($,{emit:r}){var x;const{t}=L(),m=$,V=r,k=j(),p=ee({year:((x=m.currentYear)==null?void 0:x.value)||P().year(),month:null,project:null}),I=[{text:t("upsertProfitReportModal.info.january"),value:0},{text:t("upsertProfitReportModal.info.february"),value:1},{text:t("upsertProfitReportModal.info.march"),value:2},{text:t("upsertProfitReportModal.info.april"),value:3},{text:t("upsertProfitReportModal.info.may"),value:4},{text:t("upsertProfitReportModal.info.june"),value:5},{text:t("upsertProfitReportModal.info.july"),value:6},{text:t("upsertProfitReportModal.info.august"),value:7},{text:t("upsertProfitReportModal.info.september"),value:8},{text:t("upsertProfitReportModal.info.october"),value:9},{text:t("upsertProfitReportModal.info.november"),value:10},{text:t("upsertProfitReportModal.info.december"),value:11}],C=[{text:t("upsertProfitReportModal.info.append"),value:"append"},{text:t("upsertProfitReportModal.info.business_besides_in"),value:"business_besides_in"},{text:t("upsertProfitReportModal.info.business_besides_out"),value:"business_besides_out"},{text:t("upsertProfitReportModal.info.income"),value:"income"}],S=async()=>{var o,s;try{await k.value.validateFields();try{await H.post("/profit/report",p),U.success(t("upsertProfitReportModal.message.updateProfitReportSuccess")),M(),window.location.reload()}catch(u){switch((s=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:s.message){case"无权限":{U.error(t("common.message.noAuth"));break}default:U.error(t("upsertProfitReportModal.message.updateProfitReportFailed"))}}}catch{}},z=()=>{M()},M=()=>{V("closeModal")};return(o,s)=>{const u=d("a-form-item"),_=d("a-select-option"),R=d("a-select"),Y=d("a-input-number"),e=d("a-form"),c=d("a-modal");return h(),A(c,{class:"upsert-profitReport-modal",visible:!0,title:o.$t("upsertProfitReportModal.info.updateProfitReport"),cancelText:o.$t("common.actions.cancel"),okText:o.$t("common.actions.confirm"),onOk:s[3]||(s[3]=()=>S()),onCancel:s[4]||(s[4]=()=>z())},{default:l(()=>[n(e,{ref_key:"formRef",ref:k,model:p,"label-col":{offset:1,span:5},"wrapper-col":{offset:1,span:16}},{default:l(()=>[n(u,{label:o.$t("upsertProfitReportModal.info.year"),name:"year"},{default:l(()=>[f("span",null,v(b(P)($.currentYear).year())+"年",1)]),_:1},8,["label"]),n(u,{label:o.$t("upsertProfitReportModal.info.month"),name:"month",rules:[{required:!0,message:o.$t("upsertProfitReportModal.message.monthInvalid")}]},{default:l(()=>[n(R,{value:p.month,"onUpdate:value":s[0]||(s[0]=a=>p.month=a),placeholder:o.$t("upsertProfitReportModal.info.monthPlaceholder")},{default:l(()=>[(h(),T(N,null,B(I,a=>n(_,{key:a.value,value:a.value},{default:l(()=>[w(v(a.text),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])]),_:1},8,["label","rules"]),n(u,{label:o.$t("upsertProfitReportModal.info.project"),name:"project",rules:[{required:!0,message:o.$t("upsertProfitReportModal.message.projectInvalid")}]},{default:l(()=>[n(R,{value:p.project,"onUpdate:value":s[1]||(s[1]=a=>p.project=a),placeholder:o.$t("upsertProfitReportModal.info.projectPlaceholder")},{default:l(()=>[(h(),T(N,null,B(C,a=>n(_,{key:a.value,value:a.value},{default:l(()=>[w(v(a.text),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","placeholder"])]),_:1},8,["label","rules"]),n(u,{label:o.$t("upsertProfitReportModal.info.money"),name:"money",rules:[{required:!0,type:"number",message:o.$t("upsertProfitReportModal.info.moneyInvalid")}]},{default:l(()=>[n(Y,{value:p.money,"onUpdate:value":s[2]||(s[2]=a=>p.money=a),controls:!1,placeholder:o.$t("upsertProfitReportModal.info.moneyPlaceholder"),style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label","rules"])]),_:1},8,["model"])]),_:1},8,["title","cancelText","okText"])}}});const se={class:"profit-view"},ie={class:"profit-header"},ue={style:{display:"flex"}},pe={class:"profit-title"},de={class:"profit-type"},ce={class:"profit-action"},fe={style:{padding:"8px"}},ve=K({__name:"ProfitView",setup($){const{t:r}=L();te();const t=[{dataIndex:"project",key:"project",title:r("profitView.info.project")},{dataIndex:"id",key:"id",title:r("profitView.info.row")},{title:r("profitView.info.money"),children:[{dataIndex:"january",key:"january",title:r("profitView.info.january"),customRender:({text:e})=>i(e)},{dataIndex:"february",key:"february",title:r("profitView.info.february"),customRender:({text:e})=>i(e)},{dataIndex:"march",key:"march",title:r("profitView.info.march"),customRender:({text:e})=>i(e)},{dataIndex:"april",key:"april",title:r("profitView.info.april"),customRender:({text:e})=>i(e)},{dataIndex:"may",key:"may",title:r("profitView.info.may"),customRender:({text:e})=>i(e)},{dataIndex:"june",key:"june",title:r("profitView.info.june"),customRender:({text:e})=>i(e)},{dataIndex:"july",key:"july",title:r("profitView.info.july"),customRender:({text:e})=>i(e)},{dataIndex:"august",key:"august",title:r("profitView.info.august"),customRender:({text:e})=>i(e)},,{dataIndex:"september",key:"september",title:r("profitView.info.september"),customRender:({text:e})=>i(e)},{dataIndex:"october",key:"october",title:r("profitView.info.october"),customRender:({text:e})=>i(e)},{dataIndex:"november",key:"november",title:r("profitView.info.november"),customRender:({text:e})=>i(e)},{dataIndex:"december",key:"december",title:r("profitView.info.december"),customRender:({text:e})=>i(e)},{dataIndex:"total",key:"total",title:r("profitView.info.total"),customRender:({text:e})=>i(e)}]}],m=j(F("profit-year")?P(F("profit-year")):P()),V=e=>{m.value=e,ae("profit-year",P(e).format("YYYY")),window.location.reload()},k=e=>H.post("/profit/report/get_list",{year:m.value,language:F("language")||"zh-cn",...e}),{data:p,run:I,loading:C,current:S,pageSize:z,total:M}=Z(k,{pagination:{currentKey:"page_index",pageSizeKey:"page_size",totalKey:"data.count"}});oe(()=>({total:M.value,current:S.value,pageSize:z.value,showSizeChanger:!0}));const x=(e,c,a)=>{const g=Object.assign({},c);I({page_index:e.current,page_size:e.pageSize,sortField:a.field,sortOrder:a.order,...g})},o=e=>{e()},s=e=>{e({confirm:!0})},u=j(!1),_=j({}),R=e=>{u.value=e,e||(_.value={})},Y=()=>{_.value={},R(!0)};return(e,c)=>{var O;const a=d("a-date-picker"),g=d("a-button"),G=d("a-input"),J=d("a-table");return h(),T(N,null,[f("div",se,[f("div",ie,[f("div",ue,[f("div",pe,v(e.$t("route.reports.profit")),1),f("div",de,[n(a,{value:m.value,"onUpdate:value":c[0]||(c[0]=y=>m.value=y),picker:"year",placeholder:e.$t("common.actions.yearSelectPlaceholder"),style:{"margin-left":"16px"},allowClear:!1,onChange:V},null,8,["value","placeholder"])])]),f("div",ce,[n(g,{type:"primary",style:{"margin-left":"16px"},onClick:Y},{default:l(()=>[w(v(e.$t("profitView.actions.upsertProfitReport")),1)]),_:1})])]),n(J,{columns:t,"row-key":y=>y.id,"data-source":(O=b(p))==null?void 0:O.data.rows,locale:{filterConfirm:e.$t("common.actions.confirm"),filterReset:e.$t("common.actions.reset")},pagination:!1,loading:b(C),onChange:x},{customFilterIcon:l(({filtered:y})=>[n(b(E),{style:ne({color:y?"#108ee9":void 0})},null,8,["style"])]),customFilterDropdown:l(({setSelectedKeys:y,selectedKeys:Q,confirm:q,clearFilters:W,column:X})=>[f("div",fe,[n(G,{placeholder:`${e.$t("common.actions.search")}${X.title}`,value:Q[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:D=>y(D.target.value?[D.target.value]:[]),onPressEnter:()=>o(q)},null,8,["placeholder","value","onChange","onPressEnter"]),n(g,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:()=>o(q)},{icon:l(()=>[n(b(E))]),default:l(()=>[w(" "+v(e.$t("common.actions.search")),1)]),_:2},1032,["onClick"]),n(g,{size:"small",style:{width:"90px"},onClick:()=>s(W)},{default:l(()=>[w(v(e.$t("common.actions.reset")),1)]),_:2},1032,["onClick"])])]),_:1},8,["row-key","data-source","locale","loading"])]),u.value?(h(),A(le,{key:0,upsertProfitReport:_.value,currentYear:m.value,onCloseModal:c[1]||(c[1]=()=>R(!1))},null,8,["upsertProfitReport","currentYear"])):re("",!0)],64)}}});export{ve as default};
